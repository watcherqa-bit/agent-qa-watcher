Summary,Preconditions,Action,Data,Expected Result
"TC-DL-001 – DataLayer Login","Utilisateur anonyme, page /user/login accessible.","**Scénario :** **Étant donné** un utilisateur anonyme accède à l’URL /user/login **Lorsque** la page est entièrement chargée et que la console du navigateur est ouverte **Alors** le QA exécute window.dataLayer et vérifie la présence et la complétude des clés attendues pour cette page.","URL : /user/login ; Clés attendues : drupalLanguage, drupalSitename = Safran, entityLangcode, entityType = system_page, entityBundle = user_account, entityTitle = titre de la page de login.","Résultat attendu : window.dataLayer est défini et contient un objet pour /user/login ; les clés drupalLanguage, drupalSitename, entityLangcode, entityType, entityBundle, entityTitle sont présentes et renseignées ; aucune valeur n’est vide ou égale à unknown ; drupalLanguage et entityLangcode correspondent à la langue de la page ; entityType = system_page et entityBundle = user_account ; entityTitle correspond au titre réel de la page de login ; aucune erreur JavaScript liée au dataLayer n’apparaît dans la console."
"TC-DL-002 – DataLayer Forgot Password","Utilisateur anonyme, page /user/password accessible.","**Scénario :** **Étant donné** un utilisateur anonyme ouvre la page /user/password **Lorsque** la page est entièrement chargée et que le QA inspecte window.dataLayer dans la console **Alors** il vérifie que l’objet du dataLayer pour cette page est complet et cohérent.","URL : /user/password ; Clés attendues : drupalLanguage, drupalSitename = Safran, entityLangcode, entityType = system_page, entityBundle = user_account, entityTitle = titre de la page Mot de passe oublié.","Résultat attendu : window.dataLayer est défini et contient un objet pour /user/password ; toutes les clés attendues sont présentes et renseignées ; aucune valeur n’est vide ni égale à unknown ; drupalLanguage et entityLangcode correspondent à la langue de la page ; entityType = system_page et entityBundle = user_account ; entityTitle correspond au titre réel de la page Mot de passe oublié ; aucune erreur JavaScript liée au dataLayer n’est visible en console."
"TC-DL-003 – DataLayer Register","Utilisateur anonyme, page /user/register accessible.","**Scénario :** **Étant donné** un utilisateur anonyme accède à la page /user/register **Lorsque** la page est chargée et que le QA affiche window.dataLayer dans la console **Alors** il contrôle que les métadonnées de la page d’inscription sont complètes et cohérentes.","URL : /user/register ; Clés attendues : drupalLanguage, drupalSitename = Safran, entityLangcode, entityType = system_page, entityBundle = user_account, entityTitle = titre de la page d’inscription.","Résultat attendu : window.dataLayer contient un objet pour /user/register avec toutes les clés attendues ; toutes les valeurs sont renseignées, non vides et différentes de unknown ; drupalLanguage et entityLangcode correspondent à la langue de la page ; entityType = system_page et entityBundle = user_account ; entityTitle correspond au titre réel de la page d’inscription ; aucune erreur JavaScript liée au dataLayer n’est présente dans la console."
"TC-DL-004 – DataLayer My Candidate Area","Utilisateur connecté disposant des droits d’accès à la zone candidat.","**Scénario :** **Étant donné** un utilisateur connecté ayant accès à la zone candidat ouvre /my-candidate-area **Lorsque** la page est chargée et que le QA affiche window.dataLayer dans la console **Alors** il vérifie que les informations de la page candidate_area sont correctement renseignées.","URL : /my-candidate-area ; Clés attendues : drupalLanguage, drupalSitename = Safran, entityLangcode, entityType = system_page, entityBundle = candidate_area, entityTitle = titre de la page My candidate area.","Résultat attendu : window.dataLayer contient un objet pour /my-candidate-area ; les clés drupalLanguage, drupalSitename, entityLangcode, entityType, entityBundle, entityTitle sont présentes ; entityBundle = candidate_area et entityType = system_page ; drupalLanguage et entityLangcode correspondent à la langue de la page ; entityTitle correspond au titre de la zone candidat ; aucune valeur n’est vide ou égale à unknown ; aucune erreur JavaScript liée au dataLayer n’est visible en console."
"TC-DL-005 – DataLayer Contact","Utilisateur anonyme, au moins une page /contact/* accessible.","**Scénario :** **Étant donné** un utilisateur accède à une page de contact du site (ex : /contact) **Lorsque** la page est entièrement chargée et que le QA consulte window.dataLayer **Alors** il vérifie que les valeurs du dataLayer décrivent correctement une page de type contact_tree.","URL : /contact et autres /contact/* ; Clés attendues : drupalLanguage, drupalSitename = Safran, entityLangcode, entityType = system_page, entityBundle = contact_tree, entityTitle = titre de la page de contact.","Résultat attendu : window.dataLayer contient un objet pour la page de contact testée ; toutes les clés attendues sont présentes et renseignées ; entityType = system_page et entityBundle = contact_tree ; drupalLanguage et entityLangcode correspondent à la langue de la page ; entityTitle correspond au titre de la page de contact ; aucune valeur n’est vide ou égale à unknown ; aucune erreur JavaScript liée au dataLayer n’apparaît dans la console."
"TC-DL-006 – DataLayer Sitemap","Utilisateur anonyme, page /sitemap accessible.","**Scénario :** **Étant donné** un utilisateur ouvre la page /sitemap **Lorsque** la page est chargée et que le QA affiche window.dataLayer dans la console **Alors** il vérifie que la page est correctement identifiée comme sitemap dans le dataLayer.","URL : /sitemap ; Clés attendues : drupalLanguage, drupalSitename = Safran, entityLangcode, entityType = system_page, entityBundle = sitemap, entityTitle = titre de la page Sitemap.","Résultat attendu : window.dataLayer contient un objet pour /sitemap ; les clés drupalLanguage, drupalSitename, entityLangcode, entityType, entityBundle, entityTitle sont présentes ; entityBundle = sitemap et entityType = system_page ; aucune valeur n’est vide ou égale à unknown ; entityTitle correspond au titre de la page sitemap ; aucune erreur JavaScript liée au dataLayer n’est présente en console."
"TC-DL-007 – DataLayer Account","Utilisateur connecté, pages /account/* accessibles.","**Scénario :** **Étant donné** un utilisateur connecté accède à une page de compte du type /account/* **Lorsque** la page est chargée et que le QA consulte window.dataLayer **Alors** il contrôle que les métadonnées de type user_account sont bien renseignées pour cette page.","URL : /account et quelques sous-pages /account/* ; Clés attendues : drupalLanguage, drupalSitename = Safran, entityLangcode, entityType = system_page, entityBundle = user_account, entityTitle = titre de la page de compte.","Résultat attendu : window.dataLayer contient un objet pour chaque page /account/* testée ; toutes les clés attendues sont présentes et correctement remplies ; entityType = system_page et entityBundle = user_account ; drupalLanguage et entityLangcode correspondent à la langue de la page ; entityTitle correspond au titre de la page de compte ; aucune valeur n’est vide ou égale à unknown ; aucune erreur JavaScript liée au dataLayer."
"TC-DL-008 – DataLayer Protected Publication","Utilisateur ayant accès à une publication protégée via /form/*.","**Scénario :** **Étant donné** un utilisateur accède à une publication protégée via une URL /form/* **Lorsque** la page est chargée et que le QA visualise window.dataLayer **Alors** il vérifie que la page est identifiée comme média protected_form avec un titre correct.","URL : une URL /form/* menant à une publication protégée ; Clés attendues : drupalLanguage, drupalSitename = Safran, entityLangcode, entityType = media, entityBundle = protected_form, entityTitle = titre de la publication protégée ou de la page de destination.","Résultat attendu : window.dataLayer contient un objet représentant la publication protégée ; entityType = media et entityBundle = protected_form ; entityTitle correspond au titre de la publication protégée ou de la page de destination ; drupalLanguage et entityLangcode correspondent à la langue affichée ; aucune valeur n’est vide ou égale à unknown ; aucune erreur JavaScript liée au dataLayer n’est visible en console."
"TC-DL-009 – DataLayer Archives Finances","Utilisateur anonyme, page /finance/annual-general-meeting/archives accessible.","**Scénario :** **Étant donné** un utilisateur ouvre la page /finance/annual-general-meeting/archives **Lorsque** la page est chargée et que le QA examine window.dataLayer **Alors** il vérifie que les informations de la page d’archives financières sont complètes et cohérentes.","URL : /finance/annual-general-meeting/archives ; Clés attendues : drupalLanguage, drupalSitename = Safran, entityLangcode, entityType = system_page, entityBundle = general_assembly, entityTitle = titre de la page d’archives des assemblées générales.","Résultat attendu : window.dataLayer contient un objet pour la page /finance/annual-general-meeting/archives ; les clés attendues sont présentes et renseignées ; entityType = system_page et entityBundle = general_assembly ; drupalLanguage et entityLangcode correspondent à la langue de la page ; entityTitle correspond au titre de la page d’archives ; aucune valeur n’est vide ou égale à unknown ; aucune erreur JavaScript liée au dataLayer."
"TC-DL-010 – DataLayer Multilingue EN/FR","Site configuré au minimum en EN et FR, pages accessibles dans les deux langues.","**Scénario :** **Étant donné** la même page fonctionnelle ouverte en anglais puis en français **Lorsque** le QA compare les objets window.dataLayer pour chaque langue **Alors** il vérifie que les langues et les titres sont correctement adaptés à chaque version.","URLs : par exemple /en/user/login et /fr/user/login ; Clés comparées : drupalLanguage, entityLangcode, entityTitle ; Valeurs attendues : EN = en, FR = fr, titres traduits.","Résultat attendu : sur la version EN, drupalLanguage et entityLangcode valent en et le titre est en anglais ; sur la version FR, drupalLanguage et entityLangcode valent fr et le titre est en français ; aucune valeur n’est vide ou égale à unknown pour les deux langues ; les autres clés (drupalSitename, entityType, entityBundle) restent cohérentes d’une langue à l’autre ; aucune erreur JavaScript liée au dataLayer."
"TC-DL-011 – Matomo – Disparition des unknown","Accès Matomo disponible, données collectées après déploiement du datalayer enrichi.","**Scénario :** **Étant donné** que le datalayer enrichi est déployé sur l’ensemble des pages ciblées **Lorsque** le QA consulte les rapports Matomo pour les URLs concernées **Alors** il vérifie qu’aucune dimension issue du dataLayer n’est remontée avec la valeur unknown.","Liste des URLs à vérifier dans Matomo : /user/login, /user/password, /user/register, /my-candidate-area, /contact/*, /sitemap, /account/*, /form/*, /finance/annual-general-meeting/archives.","Résultat attendu : dans Matomo, les pages listées ne présentent plus de valeurs unknown pour les dimensions basées sur le dataLayer ; les valeurs observées dans Matomo correspondent à celles vérifiées dans window.dataLayer ; si une valeur unknown est encore présente, le test est en échec et un BUG est créé avec l’URL, la dimension concernée et une capture d’écran."
